Goal: Implement "Screen Shake" on impact (but keep UI stable) and "Confetti Particles" when eating food.

Please make the following changes across 4 files:

1. Update state.js
In the game object, add two new properties:

shake: 0,

foodParticles: [],

In the resetGameState() function, reset these values:

game.shake = 0;

game.foodParticles = [];

2. Update main.js
In the window.loseLife function, trigger a screen shake at the very top:

Set game.shake = 20;

3. Update logic.js
In updateGameLogic(), find the block where food is eaten (if (game.food && tx === game.food.x ...)).

Inside that block, call a new helper function: spawnFoodParticles(tx, ty, '#ff6347');

Add the new helper function spawnFoodParticles(gridX, gridY, color) at the bottom of the file:

JavaScript

function spawnFoodParticles(gridX, gridY, color) {
    const centerX = (gridX + 0.5) * CELL_SIZE;
    const centerY = (gridY + 0.5) * CELL_SIZE;

    for (let i = 0; i < 12; i++) {
        game.foodParticles.push({
            x: centerX,
            y: centerY,
            vx: (Math.random() - 0.5) * 10, 
            vy: (Math.random() - 0.5) * 10, 
            life: 1.0, 
            color: color
        });
    }
}
4. Update renderer.js
We need to split the draw function so the background and UI are stable, but the game world shakes.

In function draw(interpolationFactor, renderDeltaTime):

Keep the Background Clear: Leave the first two lines (ctx.fillStyle..., ctx.fillRect...) exactly where they are at the top.

Start Shake: Immediately after ctx.fillRect(...), add:

JavaScript

ctx.save();
if (game.shake > 0) {
    const magnitude = game.shake;
    const x = (Math.random() - 0.5) * magnitude;
    const y = (Math.random() - 0.5) * magnitude;
    ctx.translate(x, y);
    game.shake *= 0.9; 
    if (game.shake < 0.5) game.shake = 0;
}
End Shake: Find the line if (game.feedbackMessage) {. Immediately before that line, add:

JavaScript

drawFoodParticles(ctx); // Draw particles inside the shaken world
ctx.restore();          // Stop shaking before drawing UI
Add Helper: Add the drawFoodParticles function to the bottom of the file:

JavaScript

function drawFoodParticles(ctx) {
    for (let i = game.foodParticles.length - 1; i >= 0; i--) {
        let p = game.foodParticles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 0.02; 

        if (p.life <= 0) {
            game.foodParticles.splice(i, 1);
        } else {
            ctx.globalAlpha = p.life;
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, 4, 4);
            ctx.globalAlpha = 1.0;
        }
    }
}
